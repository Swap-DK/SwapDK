---
---

<script is:inline>
document.addEventListener('DOMContentLoaded', function() {
  const codeBlocks = document.querySelectorAll('pre:has(code)');
  
  codeBlocks.forEach(function(pre) {
    if (pre.querySelector('.copy-code-button')) return;
    
    if (pre.closest('.interactive-example, .swap-demo, .wallet-demo, .step-guide')) return;
    
    const codeElement = pre.querySelector('code');
    if (!codeElement) return;
    
    const copyButton = document.createElement('button');
    copyButton.className = 'copy-code-button';
    copyButton.innerHTML = `
      <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
      </svg>
      <span class="copy-text">Copy</span>
    `;
    copyButton.title = 'Copy code to clipboard';
    
    copyButton.addEventListener('click', async function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const code = codeElement.textContent || codeElement.innerText;
      
      try {
        await navigator.clipboard.writeText(code);
        
        const copyIcon = this.querySelector('.copy-icon');
        const copyText = this.querySelector('.copy-text');
        
        if (!copyIcon || !copyText) return;
        
        const checkIcon = document.createElement('div');
        checkIcon.innerHTML = `
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20,6 9,17 4,12"/>
          </svg>
        `;
        
        const firstChild = checkIcon.firstElementChild;
        if (firstChild) {
          copyIcon.style.display = 'none';
          this.insertBefore(firstChild, copyText);
          copyText.textContent = 'Copied!';
          this.classList.add('copied');
        }
        
        setTimeout(() => {
          const checkIconElement = this.querySelector('.check-icon');
          if (checkIconElement) checkIconElement.remove();
          copyIcon.style.display = 'inline';
          copyText.textContent = 'Copy';
          this.classList.remove('copied');
        }, 2000);
        
      } catch (err) {
        console.error('Failed to copy code: ', err);
        
        const copyText = this.querySelector('.copy-text');
        if (!copyText) return;
        
        const originalText = copyText.textContent;
        copyText.textContent = 'Failed';
        this.classList.add('error');
        
        setTimeout(() => {
          copyText.textContent = originalText || 'Copy';
          this.classList.remove('error');
        }, 2000);
      }
    });
    
    pre.style.position = 'relative';
    pre.appendChild(copyButton);
  });
  
  document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'c') {
      const activeElement = document.activeElement;
      if (!activeElement) return;
      
      const codeBlock = activeElement.closest('pre');
      
      if (codeBlock && !window.getSelection()?.toString()) {
        e.preventDefault();
        const copyButton = codeBlock.querySelector('.copy-code-button');
        if (copyButton) {
          copyButton.click();
        }
      }
    }
  });
  
  codeBlocks.forEach(function(pre) {
    pre.setAttribute('tabindex', '0');
    pre.addEventListener('focus', function() {
      this.style.outline = '2px solid var(--sl-color-accent)';
      this.style.outlineOffset = '2px';
    });
    pre.addEventListener('blur', function() {
      this.style.outline = 'none';
    });
  });
});
</script>