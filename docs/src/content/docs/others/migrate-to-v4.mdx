---
title: Migrate to v4
description: Guide for upgrading from SwapDK v3 to v4
---

import { Tabs, TabItem } from "@astrojs/starlight/components";

This guide provides a comprehensive overview of all breaking changes and migration steps from SwapDK v3 to v4.

## Major Breaking Changes

### 1. Package Restructuring

v4 fundamentally changes how packages are organized:

**v3 Structure**: Individual packages for each component

```bash
@swapdk/plugin-chainflip
@swapdk/plugin-evm
@swapdk/toolbox-cosmos
@swapdk/wallet-keystore
@swapdk/api
```

**v4 Structure**: Consolidated monolithic packages with submodule exports

```bash
@swapdk/plugins/*     # All plugins in one package
@swapdk/toolboxes/*   # All toolboxes in one package
@swapdk/wallets/*     # All wallets in one package
@swapdk/helpers       # Utilities and API (previously @swapdk/api)
@swapdk/sdk          # Complete bundle with everything
```

### 2. Import Path Changes

All imports must be updated:

```diff

- import { ChainflipPlugin } from "@swapdk/plugin-chainflip";
- import { EVMPlugin } from "@swapdk/plugin-evm";
+ import { ChainflipPlugin } from "@swapdk/plugins/chainflip";
+ import { EVMPlugin } from "@swapdk/plugins/evm";


- import { getToolboxByChain } from "@swapdk/toolbox-cosmos";
- import { EVMToolbox } from "@swapdk/toolbox-evm";
+ import { getCosmosToolbox } from "@swapdk/toolboxes/cosmos";
+ import { getEvmToolbox } from "@swapdk/toolboxes/evm";


- import { keystoreWallet } from "@swapdk/wallet-keystore";
+ import { keystoreWallet } from "@swapdk/wallets/keystore";


- import { SwapKitApi } from "@swapdk/api";
+ import { SwapKitApi } from "@swapdk/helpers/api";
```

### 3. Client Initialization Changes

The SwapDK client initialization has changed:

```diff

- import { SwapKit } from "@swapdk/core";
- const client = SwapKit({
-   apis: { /* custom APIs */ },
-   rpcUrls: { /* RPC URLs */ },
-   config: { stagenet: false },
-   plugins: { ...ThorchainPlugin },
-   wallets: { ...keystoreWallet }
- });


+ import { SwapKit } from "@swapdk/core";
+ const client = SwapKit({
+   config: {
+     rpcUrls: { /* RPC URLs */ },
+     apiKeys: { /* API keys */ }
+   },
+   plugins: { ...ThorchainPlugin },
+   wallets: { ...keystoreWallet }
+ });
```

### 4. Configuration System (SKConfig)

v4 introduces a centralized configuration system:

```diff

- const client = SwapKit({
-   apis: { [Chain.Ethereum]: customEthApi },
-   rpcUrls: { [Chain.Ethereum]: "https:
- });


+ import { SKConfig } from "@swapdk/helpers";
+ SKConfig.set({
+   rpcUrls: { [Chain.Ethereum]: "https:
+   apiKeys: {
+     blockchair: "YOUR_KEY",
+     swapKit: "YOUR_KEY"
+   }
+ });
```

### 5. Plugin Interface Changes

Plugins now use the `createPlugin` helper:

```diff

- export function plugin({ getWallet, config }: SwapKitPluginParams<ConnectConfig>) {
-   return {
-     swap,
-     supportedSwapkitProviders: [ProviderName.THORCHAIN]
-   };
- }


+ import { createPlugin } from "@swapdk/plugins";
+ export const MyPlugin = createPlugin({
+   name: "myPlugin",
+   properties: { supportedSwapkitProviders: [ProviderName.THORCHAIN] },
+   methods: ({ getWallet }) => ({ swap })
+ });
```

### 6. Wallet Interface Changes

Wallets now use the `createWallet` helper:

```diff

- export const keystoreWallet: SwapKitWallet<[chains: CryptoChain[], phrase: string]> =
-   ({ addChain, apis, rpcUrls }) => {
-     return async (chains, phrase) => { /* ... */ };
-   };


+ import { createWallet } from "@swapdk/wallets";
+ export const keystoreWallet = createWallet({
+   name: "keystore",
+   hooks: ({ config }) => ({
+     async connectWallet(chains: Chain[], phrase: string) { /* ... */ }
+   })
+ });
```

### 7. Toolbox Constructor Changes

Toolboxes no longer accept RPC URLs directly:

```diff

- const toolbox = getToolboxByChain(chain, {
-   api: customApi,
-   rpcUrl: "https:
-   signer
- });


+ const toolbox = getEvmToolbox(chain, { signer });

```

### 8. Type Changes

Several type imports have changed:

```diff

- import type { EVMWallets } from "@swapdk/toolbox-evm";
+ import type { EVMToolboxes } from "@swapdk/toolboxes/evm";


- import type { QuoteRequest } from "@swapdk/api";
+ import type { QuoteRequest } from "@swapdk/helpers/api";


- SwapKitPluginParams<ConnectConfig>
+ SwapKitPluginParams
```

### 9. Removed Features

- **`ChainApis` type**: Use SKConfig system instead
- **Direct API parameter**: Configure via SKConfig
- **`walletAddressValidator` helper**: Removed from core exports
- **Individual package installations**: Must use consolidated packages

## Migration Steps

### Step 1: Update Dependencies

<Tabs syncKey="package-manager">
  <TabItem label="bun" icon="bun">
    ```bash
    # Remove v3 packages
    bun remove @swapdk/plugin-* @swapdk/toolbox-* @swapdk/wallet-*

    # Install v4 packages
    bun add @swapdk/sdk
    # or individual packages
    bun add @swapdk/core @swapdk/plugins @swapdk/toolboxes @swapdk/wallets
    ```

  </TabItem>
  <TabItem label="pnpm">
    ```bash
    # Remove v3 packages
    pnpm remove @swapdk/plugin-* @swapdk/toolbox-* @swapdk/wallet-*

    # Install v4 packages
    pnpm add @swapdk/sdk
    # or individual packages
    pnpm add @swapdk/core @swapdk/plugins @swapdk/toolboxes @swapdk/wallets
    ```

  </TabItem>
  <TabItem label="npm">
    ```bash
    # Remove v3 packages
    npm uninstall @swapdk/plugin-* @swapdk/toolbox-* @swapdk/wallet-*

    # Install v4 packages
    npm install @swapdk/sdk
    # or individual packages
    npm install @swapdk/core @swapdk/plugins @swapdk/toolboxes @swapdk/wallets
    ```

  </TabItem>
  <TabItem label="yarn">
    ```bash
    # Remove v3 packages
    yarn remove @swapdk/plugin-* @swapdk/toolbox-* @swapdk/wallet-*

    # Install v4 packages
    yarn add @swapdk/sdk
    # or individual packages
    yarn add @swapdk/core @swapdk/plugins @swapdk/toolboxes @swapdk/wallets
    ```

  </TabItem>
</Tabs>

### Step 2: Update Imports

Replace all v3 imports with v4 equivalents:

```diff
-import { THORChainPlugin } from "@swapdk/plugin-thorchain";
-import { EVMToolbox } from "@swapdk/toolbox-evm";
-import { ledgerWallet } from "@swapdk/wallet-ledger";

+import { ThorchainPlugin } from "@swapdk/plugins/thorchain";
+import { getEvmToolbox } from "@swapdk/toolboxes/evm";
+import { ledgerWallet } from "@swapdk/wallets/ledger";
```

### Step 3: Update Client Initialization

```diff
-import { SwapKitCore } from "@swapdk/core";
+import { createSwapKit } from "@swapdk/sdk";

-const client = new SwapKitCore({
+const client = createSwapKit({

});
```

### Step 4: Update Wallet Connections

The wallet connection pattern remains similar but uses the new import paths:

```typescript
// @noErrorValidation

import { createSwapKit, Chain } from "@swapdk/sdk";

const client = createSwapKit({});

await client.connectEVMWallet([Chain.Ethereum]);

const chains = [Chain.Bitcoin, Chain.Ethereum, Chain.Cosmos];
const phrase = "your mnemonic phrase here";
await client.connectKeystore(chains, phrase);
```

## New Features in v4

### 1. Runtime Configuration Updates (Major Improvement)

The biggest improvement in v4 is the ability to update configuration at runtime without recreating the SwapDK client.

#### v3 Approach (Client Recreation Required)

```typescript
// @noErrorValidation

const client1 = SwapKit({
  rpcUrls: { [Chain.Ethereum]: "https:
  apis: { [Chain.Bitcoin]: customBtcApi }
});


const client2 = SwapKit({
  rpcUrls: { [Chain.Ethereum]: "https:
  apis: { [Chain.Bitcoin]: customBtcApi }
});
```

#### v4 Approach (Runtime Updates)

```typescript
// @noErrorValidation
import { createSwapKit, SKConfig, Chain } from '@swapdk/sdk';


const swapKit = createSwapKit({
  config: {
    rpcUrls: { [Chain.Ethereum]: "https:
    apiKeys: { blockchair: "basic-key" }
  }
});


SKConfig.setRpcUrl(Chain.Ethereum, "https:
SKConfig.setApiKey("blockchair", "premium-api-key");


SKConfig.setEnv("isStagenet", true);


const balance = await swapKit.getBalance(Chain.Ethereum);
```

### 2. Individual Configuration Updates

Update specific parts of configuration without affecting others:

```typescript
// @noErrorValidation

SKConfig.setApiKey("swapKit", "your-swapkit-api-key");
SKConfig.setApiKey("walletConnectProjectId", "your-wc-project-id");
SKConfig.setApiKey("blockchair", "your-blockchair-key");


SKConfig.setRpcUrl(Chain.Ethereum, "https:
SKConfig.setRpcUrl(Chain.Arbitrum, "https:
SKConfig.setRpcUrl(Chain.Avalanche, "https:


SKConfig.setEnv("isDev", false);
SKConfig.setEnv("isStagenet", true);


SKConfig.setIntegrationConfig("radix", {
  dAppDefinitionAddress: "account_rdx...",
  applicationName: "My DeFi App",
  applicationVersion: "1.0.0",
  network: { networkId: 1, networkName: "mainnet" }
});
```

### 3. Bulk Configuration Updates

Update multiple configurations at once:

```typescript
// @noErrorValidation

SKConfig.set({
  rpcUrls: {
    [Chain.Ethereum]: "https:
    [Chain.Arbitrum]: "https:
    [Chain.Avalanche]: "https:
  },
  apiKeys: {
    blockchair: "premium-blockchair-key",
    swapKit: "premium-swapkit-key",
    walletConnectProjectId: "your-project-id"
  },
  envs: {
    isStagenet: false,
    isDev: false
  }
});
```

### 4. Dynamic Environment Switching

Switch between mainnet and testnet without recreating client:

```typescript
// @noErrorValidation

const swapKit = createSwapKit();


SKConfig.setEnv("isStagenet", true);
SKConfig.setRpcUrl(Chain.THORChain, "https:


await swapKit.connectKeystore([Chain.THORChain], phrase);
const balance = await swapKit.getBalance(Chain.THORChain);


SKConfig.setEnv("isStagenet", false);
SKConfig.setRpcUrl(Chain.THORChain, "https:
```

### 5. How Toolboxes Automatically Use Updated Config

All toolboxes in v4 dynamically retrieve configuration from SKConfig:

```typescript
// @noErrorValidation

const ethToolbox = await getEvmToolbox(Chain.Ethereum);


const rpcUrl = SKConfig.get("rpcUrls")[Chain.Ethereum];
const provider = new JsonRpcProvider(rpcUrl);


SKConfig.setRpcUrl(Chain.Ethereum, "https:


const newEthToolbox = await getEvmToolbox(Chain.Ethereum);
```

### 6. Standardized Creation Helpers

- **`createPlugin`**: Streamlined plugin creation with consistent interface
- **`createWallet`**: Simplified wallet adapter development

### 7. Enhanced Chain Support

- **Improved Solana Support**: Jupiter API integration for real-time token metadata
- **Dynamic Cosmos Fees**: Automatic fee estimation when not provided
- **Ripple Support**: Full XRP toolbox implementation
- **OneKey Wallet**: New wallet integration

### 8. Configuration State Preservation

Updates preserve existing configuration:

```typescript
// @noErrorValidation

SKConfig.setApiKey("swapKit", "key1");

SKConfig.setApiKey("blockchair", "key2");

const apiKeys = SKConfig.get("apiKeys");
console.log(apiKeys.swapKit);
console.log(apiKeys.blockchair);
```

## Common Migration Issues

### 1. TypeScript Errors

```typescript
// @noErrorValidation

import { SwapKitApi } from "@swapdk/sdk";
```

### 2. Missing RPC URL Parameter

```typescript
// @noErrorValidation




import { SKConfig, Chain, getEvmToolbox } from "@swapdk/sdk";

SKConfig.set({ rpcUrls: { [Chain.Ethereum]: "https:
const signer = /* your signer instance */;
const toolbox = getEvmToolbox(Chain.Ethereum, { signer });
```

### 3. Plugin Interface Mismatch

```typescript
// @noErrorValidation

import { createPlugin } from "@swapdk/sdk";

const swap = async (params) => {
  /* implementation */
};

export const MyPlugin = createPlugin({
  name: "myPlugin",
  methods: ({ getWallet }) => ({ swap }),
});
```

## Migration Checklist

- [ ] Update all package dependencies
- [ ] Replace all import paths
- [ ] Update client initialization code
- [ ] Configure SKConfig for RPC URLs and API keys
- [ ] Update custom plugins to use `createPlugin`
- [ ] Update custom wallets to use `createWallet`
- [ ] Remove direct API/RPC parameters from toolboxes
- [ ] Test all functionality thoroughly

## Need Help?

- üí¨ [Join our Discord](https://discord.gg/swapdk) for community support
- üêõ [Report issues on GitHub](https://github.com/Swap-DK/SwapDK/issues)
- üìö Check the [Getting Started guide](/start/getting-started) for v4 patterns
